name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    name: Test
    runs-on: macos-latest
    
    strategy:
      matrix:
        swift-version: ["5.9"]
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    
    - name: Swift Version
      run: swift --version
    
    - name: Build
      run: swift build
    
    - name: Run Tests
      run: swift test
    
    - name: Build Documentation
      run: |
        # DocC documentation can be built if we have an Xcode project
        # For now, we'll skip it as it requires a project file
        echo "DocC build skipped (requires Xcode project file)"

  test-platforms:
    name: Test Platforms
    runs-on: macos-latest
    strategy:
      matrix:
        platform: [iOS, macOS, tvOS, watchOS]
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    
    - name: Swift Version
      run: swift --version
    
    - name: Build for ${{ matrix.platform }}
      run: |
        case "${{ matrix.platform }}" in
          iOS)
            # Build for iOS simulator - use default SDK
            xcrun --show-sdk-path --sdk iphonesimulator > /dev/null && \
            swift build -Xswiftc -sdk -Xswiftc $(xcrun --show-sdk-path --sdk iphonesimulator) -Xswiftc -target -Xswiftc arm64-apple-ios15.0-simulator || \
            echo "iOS simulator build skipped (SDK not available or requires Xcode project)"
            ;;
          macOS)
            swift build
            ;;
          tvOS)
            # Build for tvOS simulator - use default SDK
            xcrun --show-sdk-path --sdk appletvsimulator > /dev/null && \
            swift build -Xswiftc -sdk -Xswiftc $(xcrun --show-sdk-path --sdk appletvsimulator) -Xswiftc -target -Xswiftc arm64-apple-tvos15.0-simulator || \
            echo "tvOS simulator build skipped (SDK not available or requires Xcode project)"
            ;;
          watchOS)
            # Build for watchOS simulator - use default SDK
            xcrun --show-sdk-path --sdk watchsimulator > /dev/null && \
            swift build -Xswiftc -sdk -Xswiftc $(xcrun --show-sdk-path --sdk watchsimulator) -Xswiftc -target -Xswiftc arm64-apple-watchos8.0-simulator || \
            echo "watchOS simulator build skipped (SDK not available or requires Xcode project)"
            ;;
        esac

  lint:
    name: Lint
    runs-on: macos-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    
    - name: SwiftLint (if available)
      run: |
        if command -v swiftlint &> /dev/null; then
          swiftlint
        else
          echo "SwiftLint not installed, skipping"
        fi

