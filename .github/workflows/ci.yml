name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    name: Test
    runs-on: macos-latest
    
    strategy:
      matrix:
        swift-version: ["5.9"]
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    
    - name: Select Xcode
      run: sudo xcode-select -s /Applications/Xcode_15.0.app
    
    - name: Swift Version
      run: swift --version
    
    - name: Build
      run: swift build
    
    - name: Run Tests
      run: swift test
    
    - name: Build Documentation
      run: |
        xcodebuild docbuild \
          -scheme RadioBrowserKit \
          -destination 'platform=macOS' \
          -derivedDataPath .build \
          || echo "DocC build requires Xcode project (optional)"

  test-platforms:
    name: Test Platforms
    runs-on: macos-latest
    strategy:
      matrix:
        platform: [iOS, macOS, tvOS, watchOS]
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    
    - name: Select Xcode
      run: sudo xcode-select -s /Applications/Xcode_15.0.app
    
    - name: Build for ${{ matrix.platform }}
      run: |
        case "${{ matrix.platform }}" in
          iOS)
            swift build -Xswiftc -sdk -Xswiftc iphonesimulator -Xswiftc -target -Xswiftc arm64-apple-ios15.0-simulator || echo "iOS simulator build may require Xcode project"
            ;;
          macOS)
            swift build
            ;;
          tvOS)
            swift build -Xswiftc -sdk -Xswiftc appletvsimulator -Xswiftc -target -Xswiftc arm64-apple-tvos15.0-simulator || echo "tvOS simulator build may require Xcode project"
            ;;
          watchOS)
            swift build -Xswiftc -sdk -Xswiftc watchsimulator -Xswiftc -target -Xswiftc arm64-apple-watchos8.0-simulator || echo "watchOS simulator build may require Xcode project"
            ;;
        esac

  lint:
    name: Lint
    runs-on: macos-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    
    - name: SwiftLint (if available)
      run: |
        if command -v swiftlint &> /dev/null; then
          swiftlint
        else
          echo "SwiftLint not installed, skipping"
        fi

